<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: $ -->

<guide link="/doc/pl/articles/partitioning-p1.xml" lang="pl">
<title>Dzielenie dysku na partycje, cz¿¿¿ 1</title>

<author title="Autor">
  <mail link="drobbins@gentoo.org">Daniel Robbins</mail>
</author>
<author title="Redaktor">
  <mail link="jackdark@gmail.com">Joshua Saddler</mail>
</author>
<author title="T¿umaczenie">
  <mail link="edi15ta@gazeta.pl">Mateusz Kotyrba</mail>
</author>

<abstract>
W tej nowej serii wskazówek Daniel Robbins pokazuje jak zmieniæ organizacjê
partycji z systemie. Ten dokument pokrywa równie¿ kilka sztuczek the trade to
minimize downtime i pokazuje jak zapobiec pope¿nieniu kosztownych pomy³ek. W tej
szczególnej wskazówce poka¿e on jak przenie¶æ katalog /home na inn± partycjê.
</abstract>

<!-- The original version of this article was first published on IBM
developerWorks, and is property of Westtech Information Services. This
document is an updated version of the original article, and contains
various improvements made by the Gentoo Linux Documentation team -->

<version>1.1</version>
<date>2005-08-18</date>

<chapter>
<title>Przenoszenie /home</title>
<section>
<title>Wprowadzenie</title>
<body>

<note>
Oryginalna wersja tego artyku³u by³a najpierw opublikowana na IBM developerWorks
i jest w³asno¶ci± Westtech Information Services. Ten dokument jest
zaktualizowan± wersj± oryginalnego artyku³u i zawiera ró¿ne ulepszenia wykonane
przez zespó³ dokumentcji Gentoo.
</note>

<p>
Partycja <path>/home</path> jest jedn± z najczê¶ciej przenoszonych partycji.
Czasami ca³a przestrzeñ w <path>/home</path> zostaje wykorzystana i wymagany
jest dodatkowy dysk twardy. Innym razem <path>/home</path> jest ustawiony jako
czê¶æ partycji g³ównego systemu plików i mo¿e byæ konieczne przeniesienie go,
aby zwiêkszyæ wydajno¶æ lub u³atwiæ tworzenie kopii zapasowych. W którymkolwiek
z tych przypadków poka¿ê jak przenie¶æ <path>/home</path> bezpiecznie i wydajnie. 
</p>

<warn>
Nastêpuj±ca technika opisuje jak przenie¶æ partycjê (partycje). Jednka¿e ta
technika jest zaprojektowana po to, aby you can "back out" of a failed partition
move i nie chroni ona przed b³êdem u¿ytkownika. Innymi s³owy w dowolnym
momencie, kiedy formatujemy partycje lub kopiujemy du¿e ilo¶ci plików, istnieje
mo¿liwo¶æ, ¿e wpiszemy z³e polecenie, powoduj±c tym samym zniszczenie du¿ej
ilo¶ci danych. Z tego powodu bardzo siê zaleca, aby <e>podj±æ odpowiednie kroki,
aby przed przej¶ciem dalej stworzyæ kopiê zapasow± wszystkich niezbêdnych plików</e>.
</warn>

<p>
Teraz jeste¶my przygotowani, jeste¶my gotowi, aby zacz±æ przenosiny
<path>/home</path>. Konkretne kroki zale¿± od tego czy obecnie
<path>/home</path> znajduje siê na osobnej partycji lub czy jest umieszczony na
partycji g³ównego systemu plików. Nale¿y mieæ to na uwadze kiedy bêdziemy
wykonywali odpowiednie kroki (zwrócê uwagê gdzie bêdzie trzeba). Teraz, je¶li
przenosimy <path>/home</path> na nowy dysk twardy, to powinien on byæ
zainstalowany w komputerze.
</p>

<p>
Je¿li przenosimy <path>/home</path> na istniej±c± partycjê (nie musi to byæ
ext2, pod warunkiem, ¿e istnieje docelowa partycja g³ówna lub rozszerzona), to
mo¿emy przej¶æ do <uri link="#step2">kroku 2</uri>.
</p>

</body>
</section>
<section>
<title>Je¶li konieczne, tworzymy now± partycjê</title>
<body>

<p>
If the new partition doesn't exist yet, you'll need to create it using
<c>cfdisk</c> (preferred) or <c>fdisk</c>. If the partition doesn't reside on
your first drive, remember to specify the name of the device as the first
argument to <c>cfdisk</c> or <c>fdisk</c>. After creating the appropriate
primary or extended partition, you should reboot so that the partition table
can be reread correctly. This is the only time you will need to reboot the
system.
</p>

</body>
</section>
</chapter>

<chapter id="step2">
<title>Create a filesystem on the new partition</title>
<section>
<body>

<p>
To create a filesystem on the new partition, first make sure you know the exact
device name for the new partition (for example, <path>/dev/sda5</path>). If
you're not sure of the exact device name, stop now and double-check! Then type
the following, as root:
</p>

<pre caption="Creating the filesystem">
# <i>mkfs.ext2 /dev/???</i>
</pre>

<p>
In the above and following code samples, <path>???</path> should be replaced
with the target partition name. After executing this command, the target
partition will contain an empty ext2 filesystem.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Mount the new filesystem in /mnt</title>
<section>
<body>

<p>
Create a directory called <path>/mnt/newpart</path>, and then mount the new
partition there:
</p>

<pre caption="Mounting the partition">
# <i>mount /dev/??? /mnt/newpart</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Drop to single-user mode</title>
<section>
<body>

<p>
I delayed this step as long as possible to maximize system availability, but we
now must drop into single-user mode, and copy files from <path>/home</path> to
<path>/mnt/newpart</path>. You shouldn't have any files open in
<path>/home</path>, and entering single-user mode eliminates this possibility:
</p>

<pre caption="Entering single user mode">
# <i>init 1</i>
</pre>

<p>
If prompted, enter the root password to perform system maintenance. You should
now have a root shell.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Change directories to /home and copy files</title>
<section>
<body>

<p>
Type the following:
</p>

<pre caption="Copying files">
# <i>cd /home</i>
# <i>cp -ax * /mnt/newpart</i>
</pre>

<p>
The <c>cp -ax</c> command recursively copies the contents of <path>/home</path>
to <path>/mnt/newpart</path>, preserving all file attributes, and not crossing
any mount points. After this command finishes, <path>/mnt/newpart</path> will
contain an exact copy of all the files and directories currently in
<path>/home</path>. If the old <path>/home</path> was on its own separate
partition (listed on a separate line in <path>/etc/fstab</path>), go to <uri
link="#step6a">step 6a</uri>. Otherwise, proceed to <uri link="#step6b">step
6b</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Use the new partition</title>
<section id="step6a">
<title>6a: /home on its own partition</title>
<body>

<note>
These instructions are for systems where the old <path>/home</path> is already
on its own dedicated partition. If this isn't the case, see <uri
link="#step6b">step 6b</uri>.
</note>

<p>
Unmount the old partition by typing:
</p>

<pre caption="Unmounting">
# <i>cd /</i>
# <i>umount /home</i>
</pre>

<p>
Then, unmount and remount the new partition:
</p>

<pre caption="Remounting the partition">
# <i>umount /mnt/newpart</i>
# <i>mount /dev/??? /home</i>
</pre>

<p>
Now, the new partition is available at /home and is ready to be used. We can
perform the last few steps in multiuser mode. Exit single-user mode, so that
the system is back up and running, by pressing <c>CTRL-D</c>.
</p>

<impo>
After the system starts up normally, log in as root and edit
<path>/etc/fstab</path> so that <path>/dev/???</path> is now mounted
automatically at <path>/home</path> instead of your old partition. For example,
change this line:
</impo>

<pre caption="Old fstab">
/dev/hda3   /home   ext2   defaults   1   2
</pre>

<p>
to this line:
</p>

<pre caption="New fstab">
/dev/???   /home   ext2   defaults   1   2
</pre>

</body>
</section>
<section id="step6b">
<title>6b: /home on a shared partition</title>
<body>

<note>
These instructions are for systems where the old <path>/home</path> is on a
shared partition.
</note>

<pre caption="Moving the directory">
# <i>cd /</i>
# <i>mv /home /home.old</i>
# <i>mkdir /home</i>
# <i>mount /dev/??? /home</i>
</pre>

<impo>
Now, leave single user mode by pressing <c>CTRL-D</c>. When the system is back
up and running, edit <path>/etc/fstab</path> and add a line like the
following:
</impo>

<pre caption="Editing fstab">
/dev/???   /home   ext2   defaults   1   2
</pre>

<p>
That way, your new partition will get mounted correctly the next time the
system is rebooted.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Finishing up</title>
<section>
<body>

<p>
We deliberately left the old <path>/home</path> directory/partition behind,
just in case there were problems copying files. After verifying that the system
is running smoothly, you can either use your old <path>/home</path> partition
for something else, or remove the <path>/home.old</path> directory.
</p>

<p>
Congratulations, you've just moved <path>/home</path>! In my next tip, we'll
reconfigure a system so that <path>/tmp</path> and <path>/var</path> are on
their own shared partition. See you then.
</p>

</body>
</section>
<section id="resources">
<title>Resources</title>
<body>

<ul>
  <li>
    In <uri link="/doc/en/articles/partitioning-p2.xml">Partitioning in
    action</uri>, I show you step-by-step how to move <path>/var</path> and
    <path>/tmp</path> to a new partition.
  </li>
  <li>
    In my first tip, <uri link="/doc/en/articles/maximum-swappage.xml">Maximum
    swappage</uri>, I show how to dramatically increase swap performance under
    Linux.
  </li>
  <li>
    In my second tip, <uri
    link="/doc/en/articles/partition-planning-tips.xml">Partition planning
    tips</uri>, I share several ways of effectively organizing your partition
    layout.
  </li>
  <li>
    I always recommend checking out the <uri
    link="http://tldp.org/docs.html#howto">howtos</uri> at <uri
    link="http://tldp.org/">The Linux Documentation Project</uri> -- they're
    a valuable resource.
  </li>
</ul>

</body>
</section>
<section>
<title>About the author</title>
<body>

<p>
Daniel Robbins lives in Albuquerque, New Mexico. He was the President/CEO of
Gentoo Technologies Inc., the Chief Architect of the Gentoo Project and is a
contributing author of several books published by MacMillan: Caldera OpenLinux
Unleashed, SuSE Linux Unleashed, and Samba Unleashed. Daniel has been involved
with computers in some fashion since the second grade when he was first exposed
to the Logo programming language and a potentially lethal dose of Pac Man.
This probably explains why he has since served as a Lead Graphic Artist at SONY
Electronic Publishing/Psygnosis. Daniel enjoys spending time with his wife Mary
and his new baby daughter, Hadassah. You can contact Daniel at
<mail>drobbins@gentoo.org</mail>.
</p>

</body>
</section>
</chapter>
</guide>
