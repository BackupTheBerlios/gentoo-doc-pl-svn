<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- Orig revision: 1.0 -->
<!-- Translator: flexx <cyberfreak@o2.pl> -->
<!-- Title: Przewodnik po distcc -->
<!-- Status: Ukończono -->
<!-- $Header: /cvsroot/gentoo-doc-pl/trans/translated/distcc.xml,v 1.2 2004/11/29 18:56:53 sekretarz Exp $ -->

<guide>
<abstract>
Ten dokument to poradnik użytkowania distcc w Gentoo.
</abstract>

<version>1.9</version>
<date>November 09, 2004</date>

<chapter>
<title>Wprowadzenie</title>
<section>
<title>Co to jest distcc?</title>
<body>

<p>
Distcc jest programem stworzonym do dzielenia zadań kompilacyjnych za pomocą sieci z 
uczestniczącymi hostami. Zawiera w sobie serwer, <c>distccd</c> oraz program klienta
, <c>distcc</c>.  Distcc dobrze współpracuje z <uri 
link="http://ccache.samba.org">ccache</uri> oraz przy odrobinie pracy z portage.
</p>

</body>
</section>
<section>
<title>Użycie distcc do bootstrapa</title>
<body>

<p>
Jeżeli planujesz użyć distcc do pomocy w bootstrap'ie instalacji Gentoo,
przeczytaj część <uri link="#bootstrapping">Użycie distcc do bootstrap'u</uri>, która znajduje się w dalszej części tego dokumentu.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Konfiguracja komputera przed instalacją distcc</title>
<section>
<title>Zależności</title>
<body>

<p>
Aby rozpocząć pracę z Distcc wszystkie komputery w Twojej sieci muszą mieć zainstalowaną tę samą wersję GCC. Mieszanie 3.3.x (gdzie x jest dowolne) jest dozwolone, jednak równoczesne stosowanie 3.3.x i 3.2.x nie: Twoje programy <b>będą</b> miały z tym problemy.
</p>

</body>
</section>
<section>
<title>Instalacja Distcc</title>
<body>

<p>
Jest kilka opcji, które musisz poznać zanim rozpoczniesz instalację distcc.
</p>

<p>
Distcc ładuje graficzny monitor pomocny w kontrolowaniu zadań, które twój komputer wysyła do kompilacji. Jeżeli używasz gnome umieść je we flagach USE. Jednak jeżeli nie masz gnome, ale nadal chciałbyś korzystać z tego monitora powinieneś umieścić gtk we flagach USE.
</p>

<pre caption="Instalacja distcc">
# <i>emerge distcc</i>
</pre>

</body>
</section>
<section>
<title>Przygotowanie Portage do używania Distcc</title>
<body>

<p>
Przygotowanie distcc do wspólnej pracy z Portage jest proste. Wykonaj poniższe kroki na każdym systemie który ma uczestniczyć w dzieleniu zadań kompilacyjnych:
</p>

<pre caption="Integracja Distcc i Portage">
# <i>emerge distcc</i>
# <i>nano -w /etc/make.conf</i>
<comment>(Zmień N na numer odpowiadający twojej konfiguracji sprzętowej)</comment>
<comment>(Powszechną strategią jest numer równy liczbie CPU + 1)</comment>
MAKEOPTS="-jN"
<comment>(Dodaj distcc do zmiennej FEATURES)</comment>
FEATURES="distcc"
</pre>

<p>
Następnie powinieneś wybrać hosty, których chcesz użyć. Komenda <c>distcc-config</c> pokazuje ich listę. Tu jest przykład hostów, które mogłyby się na niej znaleźć:
</p>

<pre caption="Przykłady definicji hostów">
192.168.0.1          192.168.0.2                       192.168.0.3
192.168.0.1/2        192.168.0.2                       192.168.0.3/10
192.168.0.1:4000/2   192.168.0.2/1                     192.168.0.3:3632/4
@192.168.0.1         @192.168.0.2:/usr/bin/distccd     192.168.0.3
<comment>(Jest jeszcze wiele innych metod definiowania hostów. Przeczytaj man distcc aby dowiedzieć się więcej na ten temat)</comment>
</pre>

<p>
To wszystko może wydawać się skomplikowane, ale w większości przypadków wariant w linii 1 lub 2 będzie wystarczający.
</p>

<ul>
  <li>W linii pierwszej jest poprostu lista hostów bez ograniczeń dotyczących liczby nadawanych zadań.</li>
  <li>
    W linii drugiej jest lista hostów, w której określona jest maksymalna liczba wykonywanych zadań(przez 
    zdefiniowanie opcji<c>/N</c>) wysyłanych na dany host w dowolnym czasie.
  </li>
</ul>

<p>
Większość ludzi nie będzie używała linii 3 oraz 4, więc odeślę cię do <uri link="http://distcc.samba.org/man/distcc_1.html">dokumentacji</uri> distcc w celu uzyskania dalszych informacji.
</p>

<p>
Na przykład, aby zdefiniować pierwszą linię z poprzedniego przykładu wpisz w konsoli:
</p>

<pre caption="Komenda do ustalenia hostów">
# <i>/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"</i>
</pre>

<p>
Dostosuj <path>/etc/conf.d/distccd</path> do swoich potrzeb i użyj dyrektywy <c>--allow</c> aby pozwolić na połączenie tylko zaufanym hostom. W celu zdobycia większej ilości informacji zajrzyj na stronę: <uri link="http://distcc.samba.org/security.html">Projekt Bezpieczeństwa Distcc </uri>.
</p>

<p>
Następnym krokiem jest włączenie deamona distcc na wszystkich uczestniczących komputerach.</p>

<pre caption="Włączenie deamona distcc">
<comment>(Dodanie distccd do domyślnego poziomu startu)</comment>
# <i>rc-update add distccd default</i>
<comment>(Włączenie deamona distcc)</comment>
# <i>/etc/init.d/distccd start</i>
</pre>

</body>
</section>
<section>
<title>Przygotowanie Distcc do pracy z Automake.</title>
<body>

<p>
W niektórych przypadkach jest to łatwiejsze niż przygotowanie do pracy z Portage. Jedyne co musisz zrobić to zaktualizować zmienną <c>PATH</c> aby zawierała <path>/usr/lib/distcc/bin</path> przed scieżką prowadzącą do <c>gcc</c> (<path>/usr/bin</path>). Jest jeszcze jedna uwaga. Jeżeli używasz ccache powinieneś umieścić distcc po części związanej z ccache:
</p>

<pre caption="Ustalanie ścieżki">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>

<p>
Następnie, wpisz <c>make -jN</c> (normalnie użyłbyś <c>make</c>). N to liczba całkowita, której wartość zależy od twojej sieci i typu komputerów, których używasz do kompilacji. Ja mam podwójny procesor P3 i K6-2/400, które kompilują wszystko dla mojego desktopu (1200MHz Athlon Thunderbird) i używam -j5. Musisz przetestować swoje własne ustawienia aby znaleźć liczbę, która daje najlepsze wyniki.</p>

</body>
</section>
</chapter>

<chapter>
<title>Kompilacja krzyżowa (ang. cross-compiling)</title>
<section>
<title>Kilka słów o kompilowaniu krzyżowym, czyli kompilowaniu na inną architekturę.</title>
<body>

<p>
Kompilowanie krzyżowe to używanie jednej architektury do budowania programów dla innej. Przykłady takiej kompilacji to np. używanie Athlona(i686) do kompilowania programu dla K6-2(i586) lub użycie Sparca do budowy programu dla PPC.
</p>

</body>
</section>
<section>
<title>Wprowadzenie do kompilowania krzyżowego.</title>
<body>

<p>
Jeżeli chcesz zobaczyć jak działa kompilowanie krzyżowe możesz zainstalować za pomocą emerge program crossdev. Nie mogę wyrazić dla niego wsparcia ponieważ nie napisałem go, ale to jest dobry sposób do rozpoczęcia kompilowania krzyżowego.</p>

</body>
</section>
</chapter>

<chapter id="bootstrapping">
<title>Używanie Distcc do Bootstrap'u</title>
<section>
<title>Krok 1: Konfiguracja Portage</title>
<body>

<p>
Wystartuj komputer z Gentoo Linux LiveCD i podążaj za<uri link="/doc/en/handbook/handbook-x86.xml?part=1">instrukcją instalacji</uri>, aż do części związanej z bootstrappingiem. Następnie skonfiguruj Portage do użycia distcc
</p>


<pre caption="Wstępna konfiguracja">
# <i>nano -w /etc/make.conf</i>
<comment>(Dodaj distcc do zmiennej FEATURES)</comment>
FEATURES="distcc"
<comment>(Zmodyfikuj zmienną MAKEOPTS aby zawierała -jN gdzie N jest odpowiadającą liczbą całkowitą)</comment>
MAKEOPTS="-jN"
</pre>

<pre caption="Ustalanie ścieżki">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>

</body>
</section>
<section>
<title>Krok 2: Instalacja Distcc</title>
<body>

<p>
Przed instalacją distcc, użytkownik o nazwie distcc musi być dodany do pliku <path>/etc/passwd</path>:
</p>

<pre caption="Tworzenie użytkownika distcc">
# <i>echo "distcc:x:240:2:distccd:/dev/null:/bin/false" &gt;&gt; /etc/passwd</i>
</pre>

<p>
Zainstaluj distcc:
</p>

<pre caption="Instalacja distcc">
# <i>USE='-*' emerge --nodeps distcc</i>
</pre>

</body>
</section>
<section>
<title>Krok 3: Konfiguracja Distcc</title>
<body>

<p>
Uruchom <c>distcc-config</c>, aby skonfigurować distcc:
</p>

<pre caption="Końcowa konfiguracja distcc">
<comment>(Zastąp host1, host2, ... numerami IP uczestniczących hostów)</comment>
# <i>/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."</i>
<comment>Przykład: <i>/usr/bin/distcc-config --set-hosts "localhost 192.168.0.4 192.168.0.6"</i></comment>
</pre>	

<p>
Distcc jest teraz przygotowane do bootstrapu! Kontynuuj czynności opisane w instrukcji instalacyjnej i <e>nie zapomnij</e> zrobić re-emerge distcc po poleceniu <c>emerge system</c>. Da ci to pewność, że wszystkie wymagane zależności są spełnione.
</p>

<note>
W czasie bootstrapu i <c>emerge system</c> distcc może nie być używane przy kompilacji części programów. Można się tego spodziewać. Niektóre ebuildy nie pracują dobrze z distcc, więc celowo je wyłączają.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Problemy</title>
<section>
<title>Mozilla i Xfree</title>
<body>

<p>
Gdy kompilujesz programy za pomocą emerge, zauważasz, że niektóre z nich nie będą dzielone między hostami. (i nie będą budowane równolegle). Dzieje się tak, ponieważ programiści Mozilli i Xfree celowo blokują kompilowanie równoległe, które jest znaną przyczyną błędów w ich programach.</p>

<p>
Czasem distcc może niespodziewanie powodować błędy w kompilacji programów. Jeżeli tak się u Ciebie dzieje, proszę zgłoś to <uri link="http://bugs.gentoo.org">nam</uri>.
</p>

</body>
</section>
<section>
<title>Jednoczesne użycie hostów z hardened-gcc i non-hardened-gcc będzie sprawiało problemy.</title>
<body>

<p>
Wyjaśnianie tego zagadnienia jest nieistotne. Niemniej jednak, jeżeli planujesz używać distcc równocześnie na hostach mających <uri 
link="/proj/en/hardened/etdyn-ssp.xml">PaX/hardened-gcc</uri> oraz tych, które go nie posiadają, będziesz miał problemy.
</p>

<p>
Rozwiązanie tego będzie wymagało trochę ostrożności z Twojej strony; powinieneś uruchomić <c>hardened-gcc -R</c> na hoście, który posiada PaX/hardened-gcc, albo włączyć ochronę PaX w swoim jądrze i zrobić <c>emerge hardened-gcc</c>. Obie są poprawne, ponieważ w gruncie rzeczy zabezpieczenia oferowane przez każdą z tych paczek są dobre i są  przejrzyste dla użytkownika.
</p>

</body>
</section>
<section>
<title>Różne wersje GCC</title>
<body>

<p>
Jeżeli masz różne wersje GCC na swoich hostach, prawdopodobnie wystąpią dziwne błędy. Jedynym rozwiązaniem jest umieszczenie na wszystkich hostach tej samej wersji GCC.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Dodatki Distcc</title>
<section>
<title>Monitory Distcc</title>
<body>

<p>
Distcc współpracuje z dwoma monitorami. Pierwszy z nich jest wbudowanym monitorem tekstowym i nazywa się <c>distccmon-text</c>. Za pierwszym uruchomieniem może on wydawać się troche niejasny, ale tak naprawdę jest bardzo prosty w obsłudze. Jeżeli uruchomisz go bez podawania parametrów wyświetli informacje tylko raz. Podając N (gdzie N to argument liczbowy) sprawisz, że informacje będą odświerzane co N sekund.</p>

<p>
Drugi to monitor graficzny. Jest on dostępny gdy podczas kompilacji dodałeś do flag USE <c>gtk</c> lub <c>gnome</c>. Bazuje na bibliotece GTK+ i pracuje w środowisku graficznym. Jest bardzo wygodny w użyciu.
</p>

<pre caption="Korzystanie z monitorów">
# <i>distccmon-text N</i>
<comment>(Or)</comment>
# <i>distccmon-gnome</i>
<comment>Do monitorowania użycia distcc przez portage możesz użyć:</comment>
# <i>DISTCC_DIR=`portageq envvar DISTCC_DIR` distccmon-text N</i>
<comment>(Or)</comment>
# <i>DISTCC_DIR=`portageq envvar DISTCC_DIR` distccmon-gnome</i>
</pre>

<impo>
Wyjaśnienie. <c>Portageq</c> jest częścią Portage, która zwraca informacje. (w tym przypadku  - jak zdefiniowana jest zmienna DISTCC_DIR). Można byłoby zastąpić to zapisem  <c>DISTCC_DIR=/var/tmp/portage/.distcc distccmon-text N</c>
</impo>

</body>
</section>
</chapter>
</guide>
