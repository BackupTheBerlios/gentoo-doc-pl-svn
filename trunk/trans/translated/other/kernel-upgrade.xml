<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- Orig revision: 1.2 -->
<!-- Translator: ShadoWW <damian@lezajsk.info> -->
<!-- Title: Aktualizacja jądra systemu -->
<!-- Status: Ukończono -->
<!-- $Id$ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<guide link="kernel-upgrade.xml">
<title>Przewodnik aktualizacji jądra Gentoo Linux'a.</title>
<author title="Author">
  <mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Tłumacz">
  <mail link="damian@lezajsk.info">Damian Kuras</mail>
</author>

<abstract>
Ten dokument opisuje proces aktualizacji jądra systemu.
</abstract>

<license/>

<version>0.1.1</version>
<date>2004-12-06</date>

<chapter>
<title>Wprowadzenie.</title>
<section>
<body>

<p>
Jądro jest jednym z niewielu rodzajów paczek w portage, które wymagają
interwencji użytkownika do zakończenia procesu aktualizacji. Portage ściągnie i
zainstaluje źródła jądra za ciebie, jednak od tego momentu to użytkownik przed
osiągnieciem jakichkolwiek zauważalnych zmian musi skompilować jądro samodzielnie.
</p>

<p>
Chociaż ten przewodnik jest przeznaczony dla użytkowników aktualizujących jądrą
z jedenej wersji do drugiej, może być również użyteczny dla użytkowników
przechodzących z jednego rodzaju jądra na inny.
</p>

<p>
<c>gentoo-dev-sources</c> są użyte jako przykład w tym dokumencie, jednak
wszelakie instrukcje można również użyć do innych paczek, które znajdują się 
w naszym drzewie.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Po co aktualizować jądro systemu?</title>
<section>
<body>

<p>
Generalnie aktualizacja jądra nie przyniesie większych zmian. Powodem dla,
którego aktualizujemy jądra może być chęć poznania nowych funkcji lub nowego
sterownika. Może to być również potrzeba ochrony przed słabymi punktami w
bezpieczeństwie lub po prostu chęć posiadania stabilnego i aktualnego systemu.
</p>

<p>
Nawet jeśli nie zechcesz aktualizować jądra za każdym razem gdy wyjdzie nowa
wersja, zalecane jest robienie tego od czasu do czasu. W przypadku gdy nowe
aktualizacje wnoszą poprawki związane z bezpieczeństwem aktualizacja jest
bezwzględnie zalecana.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Pobieranie nowych źródeł poprzez Portage.</title>
<section>
<body>

<p>
Jądro systemu aktualizujemy tak samo jak inne programy - używając
<c>emerge</c>. Prawdopodobnie zechcesz to zrobić, gdy pozycja ta pojawi się
na liście aktualizacji world. Dla przykładu:
</p>

<pre caption="Nowe źródła jądra pojawiły się na liście aktualizacji">
# <i>emerge -Dup world</i>
Calculating dependencies ...done!
[ebuild     U ] sys-kernel/gentoo-dev-sources-2.6.9-r2 [2.6.8-r5]
</pre>

<p>
Możesz wtedy zainstalować aktualizację, np.:
</p>

<pre caption="Aktualizacja źródeł jądra">
# <i>emerge -u gentoo-dev-sources</i>
</pre>

<p>
Źródła zostaną zainstalowane jako podkatalog w katalogu <path>/usr/src</path>. W
powyższym przykładzie będzie to katalog <path>/usr/src/linux-2.6.9-gentoo-r2</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aktualizacja dowiązania symbolicznego /usr/src/linux.</title>
<section>
<body>

<p>
Gentoo wymaga, aby zachować dowiązanie symboliczne znajdujące się w
<path>/usr/src/linux</path>. Powinno ono prowadzić do jądra, którego używasz.
Idąc dalej:
</p>

<pre caption="Aktualizacja dowiązania /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>

</body>
</section>
</chapter>

<chapter id="install">
<title>Konfiguracja, kompilacja i instalacja nowego jądra.</title>
<section>
<body>

<p>
Przy każdej z tych operacji powinnieneś się odnosić do instrukcji, które
zawarte są w <uri link="http://ww.gentoo.org/doc/pl/handbook/index.xml">
Handbooku Gentoo</uri> wzorująca się na <e>Konfiguracja jądra</e> i 
<e>Konfiguracja bootloadera</e>. Poniżej napisane jest w skrócie jak to zrobić.
</p>

</body>
</section>
<section>
<title>Opcja 1: Automatyczna konfiguracja jądra przy pomocy genkernel.</title>
<body>

<p>
Jeżeli używasz genkernel, musisz jedynie powtórzyć to co robiłeś gdy pierwszy
raz instalowałeś jądro systemu.
</p>

<p>
Po prostu uruchom genkernel w normlany sposób:
</p>

<pre caption="Uruchamianie genkernel">
# <i>genkernel all</i>
</pre>

<p>
Możesz również użyć dodatkowych parametrów jeżeli zechcesz skonfigurować dodatkowe
opcje jądra przy pomocy <c>menuconfig</c> i chcesz by genkernel automatycznie
zaaktualizował konfigurację gruba, wtedy uruchom genkernel w podany niżej
sposób:
</p>

<pre caption="Uruchamianie genkernel z parametrami">
# <i>genkernel --menuconfig --bootloader=grub all</i>
</pre>

<p>
Więcej infomacji znajdziesz w
<uri link="http://www.gentoo.org/doc/pl/genkernel.xml">Gentoo Linux Genkernel
Guide</uri> lub handbooku Gentoo.
</p>

</body>
</section>
<section>
<title>Opcja 2: Konfiguracja ręczna.</title>
<body>

<p>
Aby rozpocząć uruchom <c>menuconfig</c> w katalogu źródeł jądra:
</p>

<pre caption="Uruchamianie menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Wybierz opcje, które są wymagane przez twoje urządzenia i środowisko, w którym
będziesz pracował. Jeśli chcesz wiedzieć więcej na ten temat, odwołaj się do
<e>Handbooka Gentoo</e>.
</p>

<p>
Następnie skompiluj jądro i przekopiuj je do partcyji /boot. Pownownie
skorzystaj z intrukcji zawartych w handbooku pamiętając o zamontowaniu partycji
/boot w pierwszej kolejności. Przy początkowej instalacji miałbyś tą partycję
zamontowaną dużo wcześniej.
</p>

<pre caption="Kompilacja i instalacja nowego jądra">
# <i>make &amp;&amp; make modules_install</i>
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Na koniec powinnieneś zaktualizować konfigurację programu ładującego dodając
pozycję dotyczącą nowego jądra (nie kasuj jeszcze starej!) i odmontuj partycję
<path>/boot</path>. Ponownie odnieś się do handbooka do instrukcji zawartych
tutaj.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Ponowna instalacja zewnętrznych modułów.</title>
<section>
<body>

<p>
Jeśli używasz dodatkowych modułów, które nie są zawarte w źródłach jądra (np.
sterowniki graficzne Nvidia lub ATI) ale znajdują się w portage, muszą być
ponownie zainstalowane po każdej aktualizacjia jądra systemu. Jest to tak samo
proste jak ponowna instalacja innych paczek. Ponownie odnieś się do rozdziału<uri
link="http://www.gentoo.org/doc/pl/handbook/index.xml">Handbooka Gentoo</uri>
<e>Konfiguracja jądra</e> chcąc uzyskać więcej inforamcji. Ponowne zainstalowanie
tych paczek zagwarantuje również ich zbudowanie w źródła jądra znajdujące się w
<path>/usr/src/linux</path> - dlatego będą one aktualnie instalowane dla nowego
jądra, które własnie skompilowaliśmy.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Uruchamianie systemu z nowym jądrem.</title>
<section>
<body>

<p>
Następnie zamknij wszystkie aplikacje i uruchom ponownie system. Jeśli
postępowałeś zgodnie z instrukcjami, które są zamieszczone powyżej na liście
programu ładującego zobaczysz pozycję odnoszącą się do nowego jądra. Wybierz ją
i uruchom system.
</p>

<p>
Jeżeli wszystko dobrze skonfigurowałeś twój system uruchomi się bez żadnych problemów i
będziesz się mógł do niego zalogować oraz rozpocząć pracę. I na tym kończy się
proces aktualizacji jądra.
</p>
 
<p>
Jeżeli popełniłeś błąd i system nie wystartował z nowym jądrem, wtedy po prostu
uruchom go ponownie wykorzystując poprzednie działające jądro. Następnie
przechodzisz ponownie do <uri link="#install">Konfiguracji, kompilacj i 
instalacji nowego jądra</uri> - wprowadzasz odpowiednie poprawki, aby poprawić 
swoje pomyłki. W niektórych przypadkach (np. po prostu nie zaznaczyłeś 
sterownika karty sieciowej) nie będziesz nawet musiał uruchamiac ponownie 
komputera aby to zrobić.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Uruchamianie wielu jąder.</title>
<section>
<body>

<p>
Zdążyłeś zapewne zauważyć, że instalując źródła dla nowego jądra, źródła
jądra którego aktualnie używałeś nie zostały usunięte. Jest to zamierzone
działanie i pozwala Ci w prosty sposób przełączać się uruchamiając różne jądra.
</p>

<p>
Przełączanie między różnymi jądrami jest związane z  pozostawieniem źródeł
jądra w <path>/usr/src</path> oraz pozostawieniem pliku obrazu
<path>bzImage</path> w partycji typu <path>/boot</path> (nawiązując do wpisów w
konfiguracji programu ładującego). Za każdy razem gdy będziesz uruchamiał
system, będziesz proszony o wybór wersji jądra, która ma być użyta.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Usuwanie starego jądra.</title>
<section>
<body>

<p>
Kontynując poprzedni wątek, po aktualizacji możesz być całkowicie zadowolony z
nowego jądra i nie potrzebować starej wersji. Prostym sposobem na usunięcie
wszystkich źródeł z określonym wyjątkiem dla najnowszych jest użycie opcji
<e>prune</e> emerge'a. W dalszych ciągu w przykładzie używamy
gentoo-dev-sources:
</p>

<pre caption="Usuwanie starych wersji">
# <i>emerge -P gentoo-dev-sources</i>
</pre>

<p>
W większości przypadków, pliki tymaczasowe używane podczas kompilacji będa nadal
zapisane w odpowiednim podkatalogu w katalogu <path>/usr/src</path>. Bezpiecznym
rozwiązaniem jest usunięcie ich poprzez użycie polecenia <c>rm</c>.
</p>

<p>
Możesz również bezpiecznie usunąć moduły, które były używane przez poprzednie
jądro. Można to osiągnąć poprzeż usunięcie właściwych katalogów w
<path>/lib/modules</path> odnoszących się do jądra, które właśnie usuwasz. Bądź
ostrożny aby nie usunąć modułów należacych do jądra aktualnie używanego!
</p>

<p>
Na koniec możesz zamontować swoją partycję <path>/boot</path> i usunąć pliki
<path>bzImage</path> oraz <path>System.map</path> jąder systemowych, które
chesz usunąć. Powinnieneś także wyedytować konfigurację bootloadera tak by
nie było już odwołań do tego jądra.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Problemy po aktualizacji jądra?</title>
<section>
<body>

<p>
W szybko rozwijanym jądrze Linuxa nieuniknione jest, że zmiany poczynione między
jedną wersją a drugą będą sprawiały jakieś problemy. Jeżeli masz jakieś
rozwiązania pojawiających się problemów z ostatnimi wersjami <uri
link="http://www.gentoo.org/doc/pl/gentoo-kernel.xml#doc_chap2">jąder wspieranych
przez Gentoo </uri> napisz raport o tym rozwiązaniu do nas.
</p>

</body>
</section>
</chapter>

</guide>
